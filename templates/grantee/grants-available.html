{% extends 'base/base.html' %}
{%block content%}


<table style="margin-left: 20px;"> 
    <!-- Table headers -->
        <th> 
            <tr>     
                <td>Grant</td> 
                <td>Fund</td>

                <td>Status</td> 
            </tr> 
        </th> 
          
    <!-- For loop logic  -->
    {% for grant in grants %}
    <!-- Table rows -->
    <tr>
        <td>{{ grant.grant_title }}</td>
        <td>{{ grant.grant_fund }}</td>
        <!-- If grant is approved -->
        {% if grant.id in existing_application_id and existing_application_id[grant.id].is_approved %}
                <td>Approved</td>
            <!-- If grant is rejected -->
            {% elif grant.id in existing_application_id and existing_application_id[grant.id].is_rejected %}
                <td>Rejected</td>
            <!-- If grant is submitted -->
            {% elif grant.id in existing_application_id and existing_application_id[grant.id].is_submitted %}
                <td>Submitted</td>
            <!-- If grant is not submitted -->
            {%else%}
                <td>Not submitted</td>
        {%endif%}

        {% if grant.id in existing_application_id and existing_application_id[grant.id].is_submitted %}
            <!-- If application exists -->
            <td>
                <a href="{{ url_for('read_submitted_application', grant_id=grant.id, grant_application_id=existing_application_id[grant.id].id) }}">See Application</a>
            </td>
            <td>
                <form action="{{ url_for('delete_application', grant_id=grant.id, grant_application_id=existing_application_id[grant.id].id) }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn">Delete Application</button>
                </form>
            </td>

        {% elif grant.id in existing_application_id and not existing_application_id[grant.id].is_submitted %}
            <td>
                <a href="{{ url_for('apply_to_grant', grant_id=grant.id, grant_application_id=existing_application_id[grant.id].id) }}">Continue Application</a>
            </td>
            <td>
                <form action="{{ url_for('delete_application', grant_id=grant.id, grant_application_id=existing_application_id[grant.id].id) }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn">Delete Application</button>
                </form>
            </td>
        {% else %}
            <!-- If application does not exist -->
            <td><a href="{{ url_for('activate_application', grant_id=grant.id) }}">Create Application</a></td>
        {% endif %}

        
    </tr>
{% endfor %}

</table> 
{%endblock%}